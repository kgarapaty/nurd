var placeholder = module.exports = {
    
};

var _data = {};

placeholder.install = function(options) {
    if (options.jade) {
        options.jade.filters.placeholder = jadefilter;
    }
    if (options.express) {
        var createServer = options.express.createServer;
        options.express.createServer = function() {
            var app = createServer.apply(options.express, arguments);
            app.helpers({
                placeholder: expresshelper
            });
            return app;
        };
    }
};

// define jade filter
var jadefilter = placeholder.jadefilter = function(str, attrs) {
    var jade = require('jade');
    attrs = attrs || {};
    var name = attrs.define;
    name = name.substr(1, name.length-2); // remove leading and trailing quotes
    if (name) {
        _data[name] = jade.render(str.replace(/\\n/g, '\n'));
    }
    return '';
};

// define app helper
var expresshelper = placeholder.expresshelper = function(name) {
    return _data[name];
};